---
apiVersion: v1
kind: ConfigMap
metadata:
  name: setup-scripts
data:
  {{- range $path, $_ := .Files.Glob "scripts/*.sh" }}
  {{ base $path }}: |-
    {{- $.Files.Get $path | nindent 4 }}
  {{- end }}
---
{{- range $chain := .Values.chains }}
{{- if ne $chain.type "virtual" }}
{{ $defaultFile := $.Files.Get "defaults.yaml" | fromYaml }}
{{ $defaultScripts := $defaultFile.defaultScripts }}
{{ $defaultChain := get $defaultFile.defaultChains $chain.type | default dict }}

# merge defaultChain values into the $chain dict
{{ $chain = merge $chain $defaultChain }}
{{- if hasKey $chain "genesis" }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: patch-{{ $chain.name }}
data:
  genesis.json: |-
    {{ toJson $chain.genesis | nindent 4 }}
{{- end }}
{{- end }}
{{- end }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: keys
data:
  {{- range $path, $_ := .Files.Glob "configs/keys.json" }}
  {{ base $path }}: |-
    {{- $.Files.Get $path | nindent 4}}
  {{- end }}
---
